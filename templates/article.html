{% extends "base.html" %}

{% block title %}
{{ article.title }} - {{ super() }}
{% endblock title %}

{% block head_description %}
{% if article.summary %}
{{ article.summary|striptags }}
{% endif %}
{% endblock head_description %}
{% block content %}
<article>
<div class="row-fluid">
    <header class="page_header span10 offset2">
    <h1><a href="{{ SITEURL }}/{{ article.url }}"> {{ article.title }} {%if article.subtext %} <small> {{ article.subtext }} </small> {% endif %} </a></h1>
    </header>
</div>

<div class="row-fluid">
    {% if article.toc %}
    <div class="span2 table-of-content">
        <nav>
        <h4>Contents</h4>
        {{ article.toc }}
        </nav>
    </div>
    <div class="span8 article-content">
        {% else %}
        <div class="span8 offset2 article-content">
            {% endif %}

            {{ article.content }}
            <aside>
            {% for an_artcile in dates %}
            {% if an_artcile.url == article.url %}
            {% set index = loop.index0 %}
            {% if not loop.first %}
            {% set next_article = dates[index-1] %}
            {% endif %}
            {% if not loop.last %}
            {% set previous_article = dates[index+1] %}
            {% endif %}
            <nav>
            <ul class="articles_timeline">
                {% if previous_article %}
                <li class="previous_article">« <a href="{{ SITEURL }}/{{ previous_article.url }}" title="Previous: {{ previous_article.title }}">{{ previous_article.title }}</a></li>
                {% endif %}
                {% if next_article %}
                <li class="next_article"><a href="{{ SITEURL }}/{{ next_article.url }}" title="Next: {{ next_article.title }}">{{ next_article.title }}</a> »</li>
                {% endif %}
            </ul>
            </nav>
            {% endif %}
            {% endfor %}
            </aside>
            {% include 'comments.html' %}
        </div>
        <section>
        <div class="span2" style="float:right">
            {% if article.date %} 
            <h4>Published</h4>
            {% set day = article.date.strftime('%d')|int %}
            <time pubdate="pubdate" datetime="{{ article.date.isoformat() }}">{{ article.date.strftime('%b') }} {{ day }} {{- article.date.strftime(', %Y') }}</time>
            {% endif %}
            {% if article.modified %} 
            <h4>Last Updated</h4>
            {{ article.modified }}
            {% endif %}
            {% if article.category %}
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#{{ category|replace(' ', '-')|e }}-ref">{{ article.category }}</a> 
            {% endif %}
            {% if article.tags %}
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article"> 
                {% for tag in article.tags|sort %}
                <li><a href="/tags.html#{{ tag|replace(' ', '-')|e }}-ref">{{ tag }}
                    {% for aTag, tagged_articles in tags if aTag == tag %}
                    <span>{{ tagged_articles|count }}</span>
                    {% endfor %}</a></li>
                {% endfor %}
            </ul>
            {% endif %}

            {% if MAILCHIMP_FORM_ACTION %}
            {% if not EMAIL_SUBSCRIPTION_LABEL %}
            {% set EMAIL_SUBSCRIPTION_LABEL='Email Newsletter' %}
            {% endif %}
            {% if not SUBSCRIBE_BUTTON_TITLE %}
            {% set SUBSCRIBE_BUTTON_TITLE='Subscribe' %}
            {% endif %}
            {% if not EMAIL_PLACEHOLDER %}
            {% set EMAIL_PLACEHOLDER ='email address' %}
            {% endif %}
            <!-- Begin MailChimp Signup Form -->
            <div id="mc_embed_signup">
                <form action="{{ MAILCHIMP_FORM_ACTION }}" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
                    <label for="mce-EMAIL">{{ EMAIL_SUBSCRIPTION_LABEL }}</label>
                    <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="{{ EMAIL_FIELD_PLACEHOLDER }}" required>
                    <div class="clear"><input type="submit" value="{{ SUBSCRIBE_BUTTON_TITLE }}" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
                </form>
            </div>

            <!--End mc_embed_signup-->
            {% endif %}
        </div>
        </section>
    </div>
    </article>
    {% endblock content %}

    {% block script %}
    {{ super() }}
    {% include 'disqus_script_count.html' %}
    {% endblock script %}
